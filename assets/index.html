<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vidnag Framework</title>
    <link rel="icon" type="image/png" href="/assets/logo.png">
    <link rel="stylesheet" href="/assets/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <img src="/assets/logo.svg" alt="Vidnag Framework Logo" class="logo logo-svg" onerror="this.onerror=null; this.src='/assets/logo.png'; this.classList.remove('logo-svg');">
                <div class="header-text">
                    <h1>Vidnag Framework</h1>
                    <p class="subtitle">Download videos using yt-dlp</p>
                </div>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-button active" data-tab="downloads">Video Downloaders</button>
            <button class="tab-button" data-tab="tools">Video Tools</button>
            <button class="tab-button" data-tab="files">File Browser</button>
            <button class="tab-button" data-tab="settings">Settings</button>
            <button class="tab-button" data-tab="logs">Logs</button>
            <button class="help-button" id="help-modal-btn" title="Keyboard shortcuts and tips">
                <span style="font-size: 1.2rem;">?</span> Help
            </button>
        </div>

        <!-- Downloads Tab -->
        <div id="downloads-tab" class="tab-content active">
            <div class="downloads-split-layout">
                <!-- Left Column: Form and Active Downloads (30%) -->
                <div class="downloads-left-column">
                    <section class="download-form glass-card">
                        <h2>New Download</h2>
                        <form id="new-download-form">
                            <div class="form-group">
                                <label for="video-url">Video URL(s)</label>
                                <textarea id="video-url" placeholder="https://..." rows="3" required></textarea>
                                <p class="form-help">Enter one or more URLs, one per line. Multiple URLs will use no cookies by default.</p>
                                <p class="form-error" id="video-url-error"></p>
                            </div>
                            <div class="form-group">
                                <label for="cookies-file">
                                    Cookies File (Optional)
                                    <span class="help-icon" title="Required for downloading private or age-restricted videos. Cookies authenticate you with the video platform.">?</span>
                                </label>
                                <select id="cookies-file">
                                    <option value="">None</option>
                                </select>
                                <p class="cookie-hint" id="cookie-hint" style="display: none;"></p>
                            </div>
                            <button type="submit" class="btn btn-primary">Download</button>
                        </form>
                    </section>

                    <section class="active-downloads">
                        <h2>Active & Queued</h2>
                        <div id="active-downloads-list" class="downloads-list">
                            <div class="empty-state-enhanced">
                                <span class="empty-icon">üì•</span>
                                <h3>No active downloads</h3>
                                <p>Paste a video URL in the form above to get started</p>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Right Column: Past Downloads (70%) -->
                <div class="downloads-right-column">
                    <section class="past-downloads">
                        <h2>Download History</h2>
                        <div id="past-downloads-list" class="downloads-list">
                            <div class="empty-state-enhanced">
                                <span class="empty-icon">üìù</span>
                                <h3>No downloads yet</h3>
                                <p>Your completed downloads will appear here</p>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <!-- Browse Files Tab -->
        <div id="files-tab" class="tab-content">
            <!-- Video Upload Section -->
            <section class="video-upload glass-card">
                <h2>Upload Video</h2>
                <p style="color: var(--text-muted); margin-bottom: 1rem; font-size: 0.9rem;">
                    Upload a video file to use with the conversion and transformation tools.
                </p>
                <form id="video-upload-form">
                    <div class="form-group">
                        <div id="upload-drop-zone" class="upload-drop-zone">
                            <div class="upload-drop-content">
                                <span class="upload-icon">üìÅ</span>
                                <p class="upload-text">Drag and drop a video file here</p>
                                <p class="upload-or">or</p>
                                <label for="video-file-input" class="btn btn-secondary">
                                    Choose File
                                </label>
                                <input type="file" id="video-file-input" accept=".mp4,.mkv,.webm,.avi,.mov" style="display: none;" required>
                                <p class="form-help" style="margin-top: 1rem;">Supported formats: MP4, MKV, WebM, AVI, MOV (max 2GB)</p>
                                <p id="selected-file-name" class="selected-file-name" style="display: none;"></p>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="upload-video-btn">
                        <span>‚¨ÜÔ∏è</span> Upload Video
                    </button>
                </form>
            </section>

            <section class="file-browser glass-card">
                <div class="file-browser-header">
                    <h2>Downloaded Files</h2>
                    <div class="file-browser-actions">
                        <div class="file-sort-control">
                            <label for="file-sort-select">Sort by:</label>
                            <select id="file-sort-select">
                                <option value="name-asc">Name (A-Z)</option>
                                <option value="name-desc">Name (Z-A)</option>
                                <option value="size-desc">Size (Largest)</option>
                                <option value="size-asc">Size (Smallest)</option>
                                <option value="date-desc">Date (Newest)</option>
                                <option value="date-asc">Date (Oldest)</option>
                            </select>
                        </div>
                        <button id="select-all-files-btn" class="btn btn-secondary btn-small">Select All</button>
                        <button id="download-selected-btn" class="btn btn-primary btn-small" disabled>
                            <span>‚¨á</span> Download as ZIP
                        </button>
                        <button id="delete-selected-btn" class="btn btn-danger btn-small" disabled>
                            <span>üóë</span> Delete Selected
                        </button>
                    </div>
                </div>

                <div id="files-list" class="files-list">
                    <p class="empty-state">Loading files...</p>
                </div>
            </section>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <section class="version-info glass-card">
                <h2>yt-dlp Settings</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Vidnag App Version:</span>
                        <span class="info-value" id="app-version">Loading...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">yt-dlp Version:</span>
                        <span class="info-value" id="ytdlp-version">Loading...</span>
                    </div>
                </div>
                <div class="button-group">
                    <button id="update-ytdlp-btn" class="btn btn-secondary">Update yt-dlp</button>
                    <button id="clear-cache-btn" class="btn btn-secondary">Clear yt-dlp Cache</button>
                </div>
            </section>

            <section class="queue-settings glass-card">
                <h2>Queue Settings</h2>
                <div class="form-group">
                    <label for="max-concurrent">
                        Max Concurrent Downloads:
                        <span class="help-icon" title="How many videos can download simultaneously. Higher values use more bandwidth and CPU.">?</span>
                    </label>
                    <input type="number" id="max-concurrent" min="1" max="10" value="2">
                    <p class="form-help">Maximum number of downloads running at the same time</p>
                </div>
                <div class="form-group">
                    <label for="max-concurrent-conversions">
                        Max Concurrent Conversions:
                        <span class="help-icon" title="How many MP3 conversions and video transforms can run simultaneously. These are CPU-intensive operations. Recommended: 1 for systems without GPU acceleration.">?</span>
                    </label>
                    <input type="number" id="max-concurrent-conversions" min="1" max="5" value="1">
                    <p class="form-help">Maximum number of MP3/video conversions running at the same time</p>
                </div>
                <div class="form-group">
                    <label for="max-speed">
                        Max Download Speed (MiB/s):
                        <span class="help-icon" title="Limits download speed per file. Set to 0 for unlimited. Useful for preventing bandwidth saturation.">?</span>
                    </label>
                    <input type="number" id="max-speed" min="0" value="0">
                    <p class="form-help">0 = unlimited. Limit download speed for each file</p>
                </div>
                <div class="form-group">
                    <label for="min-disk-space">
                        Pause Downloads at (MB free):
                        <span class="help-icon" title="Prevents filling up your disk completely. Downloads automatically pause when free space drops below this amount.">?</span>
                    </label>
                    <input type="number" id="min-disk-space" min="100" step="100" value="1000">
                    <p class="form-help">Stop new downloads when disk space is below this threshold</p>
                </div>
                <button id="save-queue-settings-btn" class="btn btn-primary">Save Queue Settings</button>
                <div id="queue-settings-status" class="settings-status" style="display: none;"></div>
            </section>

            <section class="preferences glass-card">
                <h2>Preferences</h2>
                <div class="preference-item">
                    <div class="preference-info">
                        <strong>Theme</strong>
                        <p>Switch between dark and light mode</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="theme-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="preference-item">
                    <div class="preference-info">
                        <strong>Accent Colors</strong>
                        <p>Choose your preferred color scheme</p>
                    </div>
                    <div style="min-width: 200px;">
                        <select id="color-theme-select">
                            <option value="synthwave">Synthwave</option>
                            <option value="sunset">Sunset</option>
                            <option value="blossom">Blossom</option>
                            <option value="graphite">Graphite</option>
                            <option value="forest">Forest</option>
                            <option value="solarized">Solarized</option>
                            <option value="arctic">Arctic</option>
                            <option value="aqua">Aqua</option>
                            <option value="fireplace">Fireplace</option>
                        </select>
                    </div>
                </div>
                <div class="preference-item">
                    <div class="preference-info">
                        <strong>
                            Auto-Select Cookies
                            <span class="help-icon" title="Automatically picks the right cookie file for your URL (e.g., instagram.txt for Instagram links). Makes downloading private content easier.">?</span>
                        </strong>
                        <p>Automatically select matching cookie file based on URL domain</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="auto-cookie-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="preference-item">
                    <div class="preference-info">
                        <strong>
                            Enhanced Accessibility
                            <span class="help-icon" title="Enables keyboard navigation enhancements, ARIA attributes, and enhanced focus indicators for improved accessibility.">?</span>
                        </strong>
                        <p>Enable optional accessibility features (ARIA attributes, keyboard shortcuts, enhanced focus)</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="accessibility-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </section>

            <section class="cleanup glass-card">
                <h2>Cleanup</h2>
                <p>Remove failed downloads and stuck conversions to free up space.</p>

                <div class="cleanup-subsection">
                    <h3>Failed Downloads</h3>
                    <p class="cleanup-description">Remove failed downloads and orphaned files.</p>
                    <div class="form-group">
                        <label for="cleanup-days">Remove downloads older than:</label>
                        <select id="cleanup-days">
                            <option value="1">1 day</option>
                            <option value="7" selected>7 days</option>
                            <option value="30">30 days</option>
                            <option value="90">90 days</option>
                        </select>
                    </div>
                    <button id="cleanup-btn" class="btn btn-danger">Clean Up Failed Downloads</button>
                    <div id="cleanup-stats" class="cleanup-stats" style="display: none;">
                        <p><strong>Cleanup Results:</strong></p>
                        <p>Downloads removed: <span id="cleanup-downloads">0</span></p>
                        <p>Files removed: <span id="cleanup-files">0</span></p>
                        <p>Space freed: <span id="cleanup-space">0 MB</span></p>
                    </div>
                </div>

                <div class="cleanup-divider"></div>

                <div class="cleanup-subsection">
                    <h3>Stale Conversions</h3>
                    <p class="cleanup-description">Remove conversions stuck in "queued" or "converting" state.</p>
                    <div class="form-group">
                        <label for="cleanup-hours">Remove conversions stuck for more than:</label>
                        <select id="cleanup-hours">
                            <option value="1" selected>1 hour</option>
                            <option value="2">2 hours</option>
                            <option value="6">6 hours</option>
                            <option value="24">24 hours</option>
                        </select>
                    </div>
                    <button id="cleanup-conversions-btn" class="btn btn-danger">Clean Up Stale Conversions</button>
                    <div id="conversion-cleanup-stats" class="cleanup-stats" style="display: none;">
                        <p><strong>Cleanup Results:</strong></p>
                        <p>Conversions removed: <span id="cleanup-conversions-count">0</span></p>
                        <p>Files removed: <span id="cleanup-conversion-files">0</span></p>
                        <p>Space freed: <span id="cleanup-conversion-space">0 MB</span></p>
                    </div>
                </div>
            </section>

            <!-- Cookie Management Section -->
            <section class="cookie-management glass-card">
                <h2>Cookie Files</h2>
                <p style="color: var(--text-muted); margin-bottom: 1rem;">
                    Upload cookie files to download private or authenticated content. Cookie files must be in Netscape format (.txt) and under 5KB.
                </p>

                <div class="cookie-upload-section">
                    <input type="file" id="cookie-file-input" accept=".txt" style="display: none;">
                    <button id="upload-cookie-btn" class="btn btn-primary">
                        üì§ Upload Cookie File
                    </button>
                </div>

                <div id="cookie-files-list" style="margin-top: 1.5rem;">
                    <p class="empty-state">Loading cookie files...</p>
                </div>
            </section>

            <!-- Hardware Information Section -->
            <section class="hardware-info glass-card">
                <h2>Server Hardware Information</h2>
                <p style="color: var(--text-muted); margin-bottom: 1.5rem;">
                    View server hardware capabilities and available acceleration technologies for video processing.
                </p>

                <div id="hardware-info-content">
                    <p class="empty-state">Loading hardware information...</p>
                </div>

                <button id="refresh-hardware-btn" class="btn btn-secondary" style="margin-top: 1rem;">
                    üîÑ Refresh Hardware Info
                </button>
            </section>

            <footer class="settings-footer">
                <p>Vidnag Framework &copy; 2025 Maintained by Tidnag</p>
                <p class="footer-note">Built with yt-dlp for easy video downloading</p>
            </footer>
        </div>

        <!-- Logs Tab -->
        <div id="logs-tab" class="tab-content">
            <section class="logs-container glass-card">
                <h2>System Logs</h2>
                <p style="color: var(--text-muted); margin-bottom: 1rem; font-size: 0.9rem;">
                    Real-time logs showing yt-dlp output, download progress, and system events. Use filters to focus on specific components or log levels.
                </p>

                <div class="logs-controls">
                    <div class="filter-group">
                        <label for="log-level-filter">Level:</label>
                        <select id="log-level-filter">
                            <option value="">All Levels</option>
                            <option value="INFO">Info</option>
                            <option value="SUCCESS">Success</option>
                            <option value="WARNING">Warning</option>
                            <option value="ERROR">Error</option>
                            <option value="DEBUG">Debug</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="log-component-filter">Component:</label>
                        <select id="log-component-filter">
                            <option value="">All Components</option>
                            <option value="System">System</option>
                            <option value="API">API</option>
                            <option value="Download">Download</option>
                            <option value="Upload">Upload</option>
                            <option value="YT-DLP">YT-DLP</option>
                            <option value="Queue">Queue</option>
                            <option value="Tools">Tools</option>
                            <option value="Cleanup">Cleanup</option>
                            <option value="Cookies">Cookies</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="log-download-filter">Download ID:</label>
                        <input type="text" id="log-download-filter" placeholder="Filter by download ID">
                    </div>
                    <button id="clear-logs-btn" class="btn btn-danger btn-small">Clear Display</button>
                </div>

                <div id="logs-display" class="logs-display">
                    <p class="empty-state">Initializing log system...</p>
                </div>
            </section>
        </div>

        <!-- Tools Tab -->
        <div id="tools-tab" class="tab-content">
            <!-- Upload Tip -->
            <section class="upload-tip glass-card">
                <p style="color: var(--text-muted); font-size: 0.95rem; margin: 0;">
                    üí° <strong>Tip:</strong> Need to modify your own video? Upload it from the <strong>File Browser</strong> tab to process it here.
                </p>
            </section>

            <div class="tools-split-layout">
                <!-- Left Column: Tool Forms (30%) -->
                <div class="tools-left-column">
                    <!-- Video to MP3 Tool -->
                    <section class="tool-form glass-card">
                        <h2>Convert Video to MP3</h2>
                        <div id="mp3-source-info" class="source-info" style="display: none;">
                            <strong>Selected video:</strong> <span id="mp3-selected-video-name"></span>
                        </div>
                        <div class="form-group">
                            <label>Select Source Video:</label>
                            <select id="mp3-source-video-select">
                                <option value="">-- Select a video --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>
                                Audio Quality:
                                <span class="help-icon" title="Higher quality means better sound but larger file size. 128 kbps is a good balance for most uses.">?</span>
                            </label>
                            <select id="audio-quality-select">
                                <option value="192">High (192 kbps)</option>
                                <option value="128" selected>Medium (128 kbps)</option>
                                <option value="96">Low (96 kbps)</option>
                            </select>
                        </div>
                        <button id="start-mp3-conversion-btn" class="btn btn-primary" disabled>
                            Convert to MP3
                        </button>
                    </section>

                    <!-- Video Transform Tool -->
                    <section class="tool-form glass-card">
                        <h2>Transform Video</h2>
                        <div class="warning-box">
                            <strong>‚ö†Ô∏è Warning:</strong> Transformations modify the original video file and cannot be undone.
                        </div>
                        <div id="transform-source-info" class="source-info" style="display: none;">
                            <strong>Selected video:</strong> <span id="transform-selected-video-name"></span>
                        </div>
                        <div class="form-group">
                            <label>Select Source Video:</label>
                            <select id="transform-source-video-select">
                                <option value="">-- Select a video --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Transformation:</label>
                            <select id="transform-type-select">
                                <option value="hflip">Flip Horizontally (Mirror)</option>
                                <option value="vflip">Flip Vertically</option>
                                <option value="rotate90">Rotate 90¬∞ Clockwise</option>
                                <option value="rotate180">Rotate 180¬∞</option>
                                <option value="rotate270">Rotate 270¬∞ Clockwise (90¬∞ Counter-clockwise)</option>
                            </select>
                        </div>
                        <button id="apply-transform-btn" class="btn btn-warning" disabled>
                            Apply Transformation
                        </button>
                    </section>
                </div>

                <!-- Right Column: Active & Completed (70%) -->
                <div class="tools-right-column">
                    <section class="active-conversions">
                        <h2>Active Operations</h2>
                        <div id="active-conversions-list" class="conversions-list">
                            <p class="empty-state">No active operations</p>
                        </div>
                    </section>

                    <section class="completed-conversions">
                        <h2>Completed Conversions</h2>
                        <div id="completed-conversions-list" class="conversions-list">
                            <p class="empty-state">No completed conversions yet</p>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast notifications -->
    <!-- Help Modal -->
    <div id="help-modal" class="help-modal" style="display: none;">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h2 id="help-modal-title">üìö Help & Tips</h2>
                <button class="help-modal-close" id="help-modal-close">&times;</button>
            </div>

            <!-- Main help content (populated by JavaScript) -->
            <div class="help-modal-body" id="help-main-view">
                <!-- Content loaded from documentation.json -->
            </div>

            <!-- Detail view (overlays main content) -->
            <div class="help-detail-view" id="help-detail-view" style="display: none;">
                <div id="help-detail-content">
                    <!-- Detail content with back button populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <script src="/assets/app.js"></script>
</body>
</html>
